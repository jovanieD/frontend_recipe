import * as tslib_1 from "tslib";
import { Component, EventEmitter, Input, Output } from '@angular/core';
export class PageState {
}
export class PaginateOptions {
}
const defaults = {
    spanPages: 2,
    previousPage: true,
    nextPage: true,
    firstPage: true,
    lastPage: true,
    titles: {
        firstPage: 'First',
        previousPage: 'Previous',
        lastPage: 'Last',
        nextPage: 'Next',
        pageSize: 'Items per page'
    },
    pageSizes: [{
            value: 5,
            display: '5'
        }, {
            value: 10,
            display: '10'
        }, {
            value: 15,
            display: '15'
        }]
};
let NgxPaginateComponent = class NgxPaginateComponent {
    constructor() {
        this.pageChange = new EventEmitter();
        this.pageSizeChange = new EventEmitter();
        this.range = [];
    }
    ngOnInit() {
        this.range = [];
        this.setOptions();
        this.calculateRange();
        // this.pageChange.emit(this.page);
    }
    setOptions() {
        if (!this.options) {
            this.options = defaults;
        }
        if (!this.options.titles) {
            this.options.titles = defaults.titles;
        }
        this.internalOptions = {
            spanPages: this.options.spanPages || defaults.spanPages,
            previousPage: this.options.previousPage !== undefined ? this.options.previousPage : defaults.previousPage,
            nextPage: this.options.nextPage !== undefined ? this.options.nextPage : defaults.nextPage,
            firstPage: this.options.firstPage !== undefined ? this.options.firstPage : defaults.firstPage,
            lastPage: this.options.lastPage !== undefined ? this.options.lastPage : defaults.lastPage,
            titles: {
                firstPage: this.options.titles.firstPage || defaults.titles.firstPage,
                previousPage: this.options.titles.previousPage || defaults.titles.previousPage,
                lastPage: this.options.titles.lastPage || defaults.titles.lastPage,
                nextPage: this.options.titles.nextPage || defaults.titles.nextPage,
                pageSize: this.options.titles.pageSize || defaults.titles.pageSize
            },
            pageSizes: this.options.pageSizes || defaults.pageSizes.slice()
        };
    }
    setPageSize(pageSize) {
        this.page.pageSize = parseInt(pageSize, 10);
        // this.pageChange.emit(this.page);
        this.pageSizeChange.emit(this.page);
    }
    calculateRange() {
        this.range.length = 0;
        this.page.numberOfPages = Math.ceil(this.page.totalItems / this.page.pageSize);
        if (this.page.numberOfPages === 0) {
            this.page.numberOfPages = 1;
        }
        let upperSpan;
        // if we can add span in front of current page, add it
        if (this.page.currentPage - this.options.spanPages > 0) {
            for (let i = this.page.currentPage - this.options.spanPages; i < this.page.currentPage; i++) {
                this.range.push(i);
            }
            upperSpan = this.options.spanPages;
        }
        else {
            // if not, add as much as you can after it and adjust upper span
            upperSpan = this.options.spanPages * 2;
            for (let i = 1; i < this.page.currentPage; i++) {
                this.range.push(i);
                upperSpan--;
            }
        }
        this.range.push(this.page.currentPage);
        if (this.page.currentPage + upperSpan <= this.page.numberOfPages) {
            for (let i = this.page.currentPage + 1; i <= this.page.currentPage + upperSpan; i++) {
                this.range.push(i);
            }
        }
        else {
            for (let i = this.page.currentPage + 1; i <= this.page.numberOfPages; i++) {
                this.range.push(i);
                upperSpan--;
            }
            if (upperSpan > 0) {
                // something is still left, prepend it to array (only if bigger than 0)
                while (upperSpan > 0 && this.range[0] - 1 > 0) {
                    this.range.unshift(this.range[0] - 1);
                    upperSpan--;
                }
            }
        }
    }
    setPage(page) {
        if (this.page.currentPage !== page) {
            this.page.currentPage = page;
            this.calculateRange();
            this.pageChange.emit(this.page);
        }
    }
    previousPage() {
        if (this.page.currentPage > 1) {
            this.setPage(this.page.currentPage - 1);
        }
    }
    nextPage() {
        if (this.page.currentPage < this.page.numberOfPages) {
            this.setPage(this.page.currentPage + 1);
        }
    }
    ngDoCheck() {
        if (this.page) {
            this.calculateRange();
        }
    }
    ngOnChanges(changes) {
        if (changes['options'] && changes['options'].currentValue) {
            this.setOptions();
        }
    }
};
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", PaginateOptions)
], NgxPaginateComponent.prototype, "options", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", PageState)
], NgxPaginateComponent.prototype, "page", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", Object)
], NgxPaginateComponent.prototype, "pageChange", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", Object)
], NgxPaginateComponent.prototype, "pageSizeChange", void 0);
NgxPaginateComponent = tslib_1.__decorate([
    Component({
        selector: 'ngx-paginate',
        template: "<div class=\"page-size-selection\">\n  <span>{{internalOptions.titles.pageSize}}</span>\n  <select (change)=\"setPageSize($event.target.value)\">\n    <option *ngFor=\"let opt of internalOptions.pageSizes\">{{opt.display}}</option>\n  </select>\n</div>\n<div class=\"pages\">\n  <span\n    class=\"first-page-button page-entry\"\n    *ngIf=\"internalOptions.firstPage\"\n    (click)=\"setPage(1)\"\n    [ngClass]=\"{'disabled':page.currentPage === 1}\">\n    {{internalOptions.titles.firstPage}}\n  </span>\n  <span\n    class=\"prev-button page-entry\"\n    *ngIf=\"internalOptions.previousPage\"\n    (click)=\"previousPage()\"\n    [ngClass]=\"{'disabled':page.currentPage === 1}\">\n    {{internalOptions.titles.previousPage}}\n  </span>\n  <span class=\"page-selection\">\n    <span\n      *ngFor=\"let num of range\"\n      class=\"page-entry\"\n      [ngClass]=\"{'active': num === page.currentPage}\"\n      (click)=\"setPage(num)\">{{num}}</span>\n  </span>\n  <span\n    class=\"next-button page-entry\"\n    *ngIf=\"internalOptions.nextPage\"\n    (click)=\"nextPage()\"\n    [ngClass]=\"{'disabled':page.currentPage === page.numberOfPages}\">\n      {{internalOptions.titles.nextPage}}\n  </span>\n  <span\n    class=\"last-page-button page-entry\"\n    *ngIf=\"internalOptions.lastPage\"\n    (click)=\"setPage(page.numberOfPages)\"\n    [ngClass]=\"{'disabled':page.currentPage === page.numberOfPages}\">\n    {{internalOptions.titles.lastPage}}\n  </span>\n</div>\n",
        styles: [":host{display:flex;width:100%;align-items:center;justify-content:space-between}.page-selection{display:flex;justify-content:center}select{height:30px}.pages{display:flex}.page-entry{height:30px;display:flex;align-items:center;justify-content:center;border:none;background-color:#eeedee;margin:0 1px;cursor:pointer;white-space:nowrap;min-width:14px;width:auto;padding:0 8px}.page-entry.active{color:#fff;background-color:#b6b6b6;cursor:default}.page-entry.disabled{opacity:.3;cursor:default}"]
    }),
    tslib_1.__metadata("design:paramtypes", [])
], NgxPaginateComponent);
export { NgxPaginateComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXBhZ2luYXRlLyIsInNvdXJjZXMiOlsic3JjL2FwcC9wYWdpbmF0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVcsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUVsSCxNQUFNLE9BQU8sU0FBUztDQUtyQjtBQUVELE1BQU0sT0FBTyxlQUFlO0NBaUIzQjtBQUVELE1BQU0sUUFBUSxHQUFvQjtJQUNoQyxTQUFTLEVBQUcsQ0FBQztJQUNiLFlBQVksRUFBRSxJQUFJO0lBQ2xCLFFBQVEsRUFBRSxJQUFJO0lBQ2QsU0FBUyxFQUFFLElBQUk7SUFDZixRQUFRLEVBQUUsSUFBSTtJQUNkLE1BQU0sRUFBRTtRQUNOLFNBQVMsRUFBRSxPQUFPO1FBQ2xCLFlBQVksRUFBRSxVQUFVO1FBQ3hCLFFBQVEsRUFBRSxNQUFNO1FBQ2hCLFFBQVEsRUFBRSxNQUFNO1FBQ2hCLFFBQVEsRUFBRSxnQkFBZ0I7S0FDM0I7SUFDRCxTQUFTLEVBQUUsQ0FBQztZQUNWLEtBQUssRUFBRSxDQUFDO1lBQ1IsT0FBTyxFQUFFLEdBQUc7U0FDYixFQUFFO1lBQ0QsS0FBSyxFQUFFLEVBQUU7WUFDVCxPQUFPLEVBQUUsSUFBSTtTQUNkLEVBQUU7WUFDRCxLQUFLLEVBQUUsRUFBRTtZQUNULE9BQU8sRUFBRSxJQUFJO1NBQ2QsQ0FBQztDQUNILENBQUM7QUFPRixJQUFhLG9CQUFvQixHQUFqQyxNQUFhLG9CQUFvQjtJQVMvQjtRQUhVLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBYSxDQUFDO1FBQzNDLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQWEsQ0FBQztRQUd2RCxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztJQUNsQixDQUFDO0lBR0QsUUFBUTtRQUNOLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFB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LEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDekM7SUFDSCxDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDbkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQztTQUN6QztJQUNILENBQUM7SUFFRCxTQUFTO1FBQ1AsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2IsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1NBQ3ZCO0lBQ0gsQ0FBQztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsWUFBWSxFQUFFO1lBQ3pELElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUNuQjtJQUNILENBQUM7Q0FDRixDQUFBO0FBaklVO0lBQVIsS0FBSyxFQUFFO3NDQUFVLGVBQWU7cURBQUM7QUFFekI7SUFBUixLQUFLLEVBQUU7c0NBQU8sU0FBUztrREFBQztBQUNmO0lBQVQsTUFBTSxFQUFFOzt3REFBNEM7QUFDM0M7SUFBVCxNQUFNLEVBQUU7OzREQUFnRDtBQVA5QyxvQkFBb0I7SUFMaEMsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLGNBQWM7UUFDeEIsbzlDQUF3Qzs7S0FFekMsQ0FBQzs7R0FDVyxvQkFBb0IsQ0FvSWhDO1NBcElZLG9CQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRG9DaGVjaywgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIE91dHB1dCwgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5leHBvcnQgY2xhc3MgUGFnZVN0YXRlIHtcbiAgY3VycmVudFBhZ2U6IG51bWJlcjtcbiAgcGFnZVNpemU6IG51bWJlcjtcbiAgdG90YWxJdGVtcz86IG51bWJlcjtcbiAgbnVtYmVyT2ZQYWdlcz86IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIFBhZ2luYXRlT3B0aW9ucyB7XG4gIHNwYW5QYWdlcz86IG51bWJlcjsgLy8gIG51bWJlciBvZiBob3cgbWFueSBwYWdlcyBhZGRpdGlvbmFsbHkgd2lsbCBiZSBzaG93biBvbiBsZWZ0IGFuZCByaWdodFxuICBmaXJzdFBhZ2U/OiBib29sZWFuO1xuICBwcmV2aW91c1BhZ2U/OiBib29sZWFuO1xuICBuZXh0UGFnZT86IGJvb2xlYW47XG4gIGxhc3RQYWdlPzogYm9vbGVhbjtcbiAgcGFnZVNpemVzPzoge1xuICAgIHZhbHVlOiBudW1iZXIsXG4gICAgZGlzcGxheTogc3RyaW5nXG4gIH1bXTtcbiAgdGl0bGVzPzoge1xuICAgIGZpcnN0UGFnZT86IHN0cmluZztcbiAgICBsYXN0UGFnZT86IHN0cmluZztcbiAgICBwcmV2aW91c1BhZ2U/OiBzdHJpbmc7XG4gICAgbmV4dFBhZ2U/OiBzdHJpbmc7XG4gICAgcGFnZVNpemU/OiBzdHJpbmc7XG4gIH07XG59XG5cbmNvbnN0IGRlZmF1bHRzOiBQYWdpbmF0ZU9wdGlvbnMgPSB7XG4gIHNwYW5QYWdlcyA6IDIsXG4gIHByZXZpb3VzUGFnZTogdHJ1ZSxcbiAgbmV4dFBhZ2U6IHRydWUsXG4gIGZpcnN0UGFnZTogdHJ1ZSxcbiAgbGFzdFBhZ2U6IHRydWUsXG4gIHRpdGxlczoge1xuICAgIGZpcnN0UGFnZTogJ0ZpcnN0JyxcbiAgICBwcmV2aW91c1BhZ2U6ICdQcmV2aW91cycsXG4gICAgbGFzdFBhZ2U6ICdMYXN0JyxcbiAgICBuZXh0UGFnZTogJ05leHQnLFxuICAgIHBhZ2VTaXplOiAnSXRlbXMgcGVyIHBhZ2UnXG4gIH0sXG4gIHBhZ2VTaXplczogW3tcbiAgICB2YWx1ZTogNSxcbiAgICBkaXNwbGF5OiAnNSdcbiAgfSwge1xuICAgIHZhbHVlOiAxMCxcbiAgICBkaXNwbGF5OiAnMTAnXG4gIH0sIHtcbiAgICB2YWx1ZTogMTUsXG4gICAgZGlzcGxheTogJzE1J1xuICB9XVxufTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LXBhZ2luYXRlJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BhZ2luYXRlLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vcGFnaW5hdGUuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBOZ3hQYWdpbmF0ZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgRG9DaGVjaywgT25DaGFuZ2VzIHtcblxuICBpbnRlcm5hbE9wdGlvbnM6IFBhZ2luYXRlT3B0aW9ucztcbiAgQElucHV0KCkgb3B0aW9uczogUGFnaW5hdGVPcHRpb25zO1xuXG4gIEBJbnB1dCgpIHBhZ2U6IFBhZ2VTdGF0ZTtcbiAgQE91dHB1dCgpIHBhZ2VDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPFBhZ2VTdGF0ZT4oKTtcbiAgQE91dHB1dCgpIHBhZ2VTaXplQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxQYWdlU3RhdGU+KCk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5yYW5nZSA9IFtdO1xuICB9XG5cbiAgcmFuZ2U6IG51bWJlcltdO1xuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnJhbmdlID0gW107XG4gICAgdGhpcy5zZXRPcHRpb25zKCk7XG5cbiAgICB0aGlzLmNhbGN1bGF0ZVJhbmdlKCk7XG4gICAgLy8gdGhpcy5wYWdlQ2hhbmdlLmVtaXQodGhpcy5wYWdlKTtcbiAgfVxuXG4gIHNldE9wdGlvbnMoKSB7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMpIHtcbiAgICAgIHRoaXMub3B0aW9ucyA9IGRlZmF1bHRzO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5vcHRpb25zLnRpdGxlcykge1xuICAgICAgdGhpcy5vcHRpb25zLnRpdGxlcyA9IGRlZmF1bHRzLnRpdGxlcztcbiAgICB9XG4gICAgdGhpcy5pbnRlcm5hbE9wdGlvbnMgPSB7XG4gICAgICBzcGFuUGFnZXM6IHRoaXMub3B0aW9ucy5zcGFuUGFnZXMgfHwgZGVmYXVsdHMuc3BhblBhZ2VzLFxuICAgICAgcHJldmlvdXNQYWdlOiB0aGlzLm9wdGlvbnMucHJldmlvdXNQYWdlICE9PSB1bmRlZmluZWQgPyB0aGlzLm9wdGlvbnMucHJldmlvdXNQYWdlIDogZGVmYXVsdHMucHJldmlvdXNQYWdlLFxuICAgICAgbmV4dFBhZ2U6IHRoaXMub3B0aW9ucy5uZXh0UGFnZSAhPT0gdW5kZWZpbmVkID8gdGhpcy5vcHRpb25zLm5leHRQYWdlIDogZGVmYXVsdHMubmV4dFBhZ2UsXG4gICAgICBmaXJzdFBhZ2U6IHRoaXMub3B0aW9ucy5maXJzdFBhZ2UgIT09IHVuZGVmaW5lZCA/IHRoaXMub3B0aW9ucy5maXJzdFBhZ2UgOiBkZWZhdWx0cy5maXJzdFBhZ2UsXG4gICAgICBsYXN0UGFnZTogdGhpcy5vcHRpb25zLmxhc3RQYWdlICE9PSB1bmRlZmluZWQgPyB0aGlzLm9wdGlvbnMubGFzdFBhZ2UgOiBkZWZhdWx0cy5sYXN0UGFnZSxcbiAgICAgIHRpdGxlczoge1xuICAgICAgICBmaXJzdFBhZ2U6IHRoaXMub3B0aW9ucy50aXRsZXMuZmlyc3RQYWdlIHx8IGRlZmF1bHRzLnRpdGxlcy5maXJzdFBhZ2UsXG4gICAgICAgIHByZXZpb3VzUGFnZTogdGhpcy5vcHRpb25zLnRpdGxlcy5wcmV2aW91c1BhZ2UgfHwgZGVmYXVsdHMudGl0bGVzLnByZXZpb3VzUGFnZSxcbiAgICAgICAgbGFzdFBhZ2U6IHRoaXMub3B0aW9ucy50aXRsZXMubGFzdFBhZ2UgfHwgZGVmYXVsdHMudGl0bGVzLmxhc3RQYWdlLFxuICAgICAgICBuZXh0UGFnZTogdGhpcy5vcHRpb25zLnRpdGxlcy5uZXh0UGFnZSB8fCBkZWZhdWx0cy50aXRsZXMubmV4dFBhZ2UsXG4gICAgICAgIHBhZ2VTaXplOiB0aGlzLm9wdGlvbnMudGl0bGVzLnBhZ2VTaXplIHx8IGRlZmF1bHRzLnRpdGxlcy5wYWdlU2l6ZVxuICAgICAgfSxcbiAgICAgIHBhZ2VTaXplczogdGhpcy5vcHRpb25zLnBhZ2VTaXplcyB8fCBkZWZhdWx0cy5wYWdlU2l6ZXMuc2xpY2UoKVxuICAgIH07XG4gIH1cblxuICBzZXRQYWdlU2l6ZShwYWdlU2l6ZSkge1xuICAgIHRoaXMucGFnZS5wYWdlU2l6ZSA9IHBhcnNlSW50KHBhZ2VTaXplLCAxMCk7XG4gICAgLy8gdGhpcy5wYWdlQ2hhbmdlLmVtaXQodGhpcy5wYWdlKTtcbiAgICB0aGlzLnBhZ2VTaXplQ2hhbmdlLmVtaXQodGhpcy5wYWdlKTtcbiAgfVxuXG4gIGNhbGN1bGF0ZVJhbmdlKCkge1xuICAgIHRoaXMucmFuZ2UubGVuZ3RoID0gMDtcbiAgICB0aGlzLnBhZ2UubnVtYmVyT2ZQYWdlcyA9IE1hdGguY2VpbCh0aGlzLnBhZ2UudG90YWxJdGVtcyAvIHRoaXMucGFnZS5wYWdlU2l6ZSk7XG5cbiAgICBpZiAodGhpcy5wYWdlLm51bWJlck9mUGFnZXMgPT09IDApIHtcbiAgICAgIHRoaXMucGFnZS5udW1iZXJPZlBhZ2VzID0gMTtcbiAgICB9XG4gICAgbGV0IHVwcGVyU3BhbjtcblxuICAgIC8vIGlmIHdlIGNhbiBhZGQgc3BhbiBpbiBmcm9udCBvZiBjdXJyZW50IHBhZ2UsIGFkZCBpdFxuICAgIGlmICh0aGlzLnBhZ2UuY3VycmVudFBhZ2UgLSB0aGlzLm9wdGlvbnMuc3BhblBhZ2VzID4gMCkge1xuICAgICAgZm9yIChsZXQgaSA9IHRoaXMucGFnZS5jdXJyZW50UGFnZSAtIHRoaXMub3B0aW9ucy5zcGFuUGFnZXM7IGkgPCB0aGlzLnBhZ2UuY3VycmVudFBhZ2U7IGkrKykge1xuICAgICAgICB0aGlzLnJhbmdlLnB1c2goaSk7XG4gICAgICB9XG4gICAgICB1cHBlclNwYW4gPSB0aGlzLm9wdGlvbnMuc3BhblBhZ2VzO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBpZiBub3QsIGFkZCBhcyBtdWNoIGFzIHlvdSBjYW4gYWZ0ZXIgaXQgYW5kIGFkanVzdCB1cHBlciBzcGFuXG4gICAgICB1cHBlclNwYW4gPSB0aGlzLm9wdGlvbnMuc3BhblBhZ2VzICogMjtcbiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdGhpcy5wYWdlLmN1cnJlbnRQYWdlOyBpKyspIHtcbiAgICAgICAgdGhpcy5yYW5nZS5wdXNoKGkpO1xuICAgICAgICB1cHBlclNwYW4tLTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnJhbmdlLnB1c2godGhpcy5wYWdlLmN1cnJlbnRQYWdlKTtcblxuICAgIGlmICh0aGlzLnBhZ2UuY3VycmVudFBhZ2UgKyB1cHBlclNwYW4gPD0gdGhpcy5wYWdlLm51bWJlck9mUGFnZXMpIHtcbiAgICAgIGZvciAobGV0IGkgPSB0aGlzLnBhZ2UuY3VycmVudFBhZ2UgKyAxOyBpIDw9IHRoaXMucGFnZS5jdXJyZW50UGFnZSArIHVwcGVyU3BhbjsgaSsrKSB7XG4gICAgICAgIHRoaXMucmFuZ2UucHVzaChpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChsZXQgaSA9IHRoaXMucGFnZS5jdXJyZW50UGFnZSArIDE7IGkgPD0gdGhpcy5wYWdlLm51bWJlck9mUGFnZXM7IGkrKykge1xuICAgICAgICB0aGlzLnJhbmdlLnB1c2goaSk7XG4gICAgICAgIHVwcGVyU3Bhbi0tO1xuICAgICAgfVxuXG4gICAgICBpZiAodXBwZXJTcGFuID4gMCApIHtcbiAgICAgICAgLy8gc29tZXRoaW5nIGlzIHN0aWxsIGxlZnQsIHByZXBlbmQgaXQgdG8gYXJyYXkgKG9ubHkgaWYgYmlnZ2VyIHRoYW4gMClcbiAgICAgICAgd2hpbGUgKHVwcGVyU3BhbiA+IDAgJiYgdGhpcy5yYW5nZVswXSAtIDEgPiAwKSB7XG4gICAgICAgICAgdGhpcy5yYW5nZS51bnNoaWZ0KHRoaXMucmFuZ2VbMF0gLSAxKTtcbiAgICAgICAgICB1cHBlclNwYW4tLTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfVxuXG4gIH1cblxuICBzZXRQYWdlKHBhZ2U6IG51bWJlcikge1xuICAgIGlmICh0aGlzLnBhZ2UuY3VycmVudFBhZ2UgIT09IHBhZ2UpIHtcbiAgICAgIHRoaXMucGFnZS5jdXJyZW50UGFnZSA9IHBhZ2U7XG4gICAgICB0aGlzLmNhbGN1bGF0ZVJhbmdlKCk7XG4gICAgICB0aGlzLnBhZ2VDaGFuZ2UuZW1pdCh0aGlzLnBhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIHByZXZpb3VzUGFnZSgpIHtcbiAgICBpZiAodGhpcy5wYWdlLmN1cnJlbnRQYWdlID4gMSkge1xuICAgICAgdGhpcy5zZXRQYWdlKHRoaXMucGFnZS5jdXJyZW50UGFnZSAtIDEpO1xuICAgIH1cbiAgfVxuXG4gIG5leHRQYWdlKCkge1xuICAgIGlmICh0aGlzLnBhZ2UuY3VycmVudFBhZ2UgPCB0aGlzLnBhZ2UubnVtYmVyT2ZQYWdlcykge1xuICAgICAgdGhpcy5zZXRQYWdlKHRoaXMucGFnZS5jdXJyZW50UGFnZSArIDEpO1xuICAgIH1cbiAgfVxuXG4gIG5nRG9DaGVjaygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5wYWdlKSB7XG4gICAgICB0aGlzLmNhbGN1bGF0ZVJhbmdlKCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzWydvcHRpb25zJ10gJiYgY2hhbmdlc1snb3B0aW9ucyddLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgdGhpcy5zZXRPcHRpb25zKCk7XG4gICAgfVxuICB9XG59XG4iXX0=